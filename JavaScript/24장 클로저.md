# 24. í´ë¡œì €

> MDN: í´ë¡œì €ëŠ” í•¨ìˆ˜ì™€ ê·¸ í•¨ìˆ˜ê°€ ì„ ì–¸ëœ ë ‰ì‹œì»¬ í™˜ê²½ê³¼ì˜ ì¡°í•©ì´ë‹¤.

```jsx
const x = 1;

function outerFunc() {
  const x = 10;
  innerFunc();
}

function innerFunc() {
  console.log(x); // 1
}

outerFunc();
```

- ì¤‘ì²© í•¨ìˆ˜ `innerFunc`ì˜ ìƒìœ„ ìŠ¤ì½”í”„ = ì™¸ë¶€ í•¨ìˆ˜ `outerFunc`ì˜ ìŠ¤ì½”í”„
  â†’ `innerFunc` í•¨ìˆ˜ì—ì„œ outer `Func` í•¨ìˆ˜ì˜ ë³€ìˆ˜ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŒ
  - **ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ë ‰ì‹œì»¬ ìŠ¤ì½”í”„ë¥¼ ë”°ë¥´ëŠ” í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì´ê¸° ë•Œë¬¸!**

## 24.1 ë ‰ì‹œì»¬ ìŠ¤ì½”í”„

ğŸ’¡ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„:
í•¨ìˆ˜ë¥¼ ì–´ë””ì„œ í˜¸ì¶œí–ˆëŠ”ì§€ê°€ ì•„ë‹ˆë¼ **í•¨ìˆ˜ë¥¼ ì–´ë””ì„œ ì •ì˜í–ˆëŠ”ì§€ì— ë”°ë¼ ìƒìœ„ ìŠ¤ì½”í”„ë¥¼ ê²°ì •** - **ë ‰ì‹œì»¬ ìŠ¤ì½”í”„(ì •ì  ìŠ¤ì½”í”„)**

```jsx
const x = 1;
function foo() {
  const x = 10;
  bar();
}
function bar() {
  console.log(x);
}
foo(); // 1
bar(); // 1
```

- `foo` í•¨ìˆ˜, `bar` í•¨ìˆ˜ì˜ ìƒìœ„ ìŠ¤ì½”í”„ = ì „ì—­ ìŠ¤ì½”í”„

> ğŸ“ŒÂ **ìŠ¤ì½”í”„**ì˜ ì‹¤ì²´: **ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ì˜ ë ‰ì‹œì»¬ í™˜ê²½**

- ë ‰ì‹œì»¬ í™˜ê²½ì€ â€œì™¸ë¶€ ë ‰ì‹œì»¬ í™˜ê²½ì— ëŒ€í•œ ì°¸ì¡°â€ë¥¼ í†µí•´ ìƒìœ„ ë ‰ì‹œì»¬ í™˜ê²½ê³¼ ì—°ê²° (ìŠ¤ì½”í”„ ì²´ì¸)

## 24.2 í•¨ìˆ˜ ê°ì²´ì˜ ë‚´ë¶€ ìŠ¬ë¡¯ [[Environment]]

- **í•¨ìˆ˜**: ìì‹ ì˜ ë‚´ë¶€ ìŠ¬ë¡¯ `[[Environment]]`ì— ìì‹ ì´ ì •ì˜ëœ í™˜ê²½, ì¦‰ **ìƒìœ„ ìŠ¤ì½”í”„ì˜ ì°¸ì¡°ë¥¼ ì €ì¥**
  - í•¨ìˆ˜ ì •ì˜ê°€ í‰ê°€ë˜ì–´ í•¨ìˆ˜ ê°ì²´ë¥¼ ìƒì„±í•  ë•Œ
    â†’ **í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ì˜ ë ‰ì‹œì»¬ í™˜ê²½ì´ í•¨ìˆ˜ì˜ `[[Environment]]`ì— ì €ì¥ë¨**

![image](https://github.com/jwo0o0/Modern-Javascript-Deep-Dive/assets/70098708/82bb5d0c-0746-4a6a-921f-12de4703421b)

## 24.3 í´ë¡œì €ì™€ ë ‰ì‹œì»¬ í™˜ê²½

```jsx
const x = 1;

function outer() {
  const x = 10;
  const inner = function () {
    console.log(x);
  };
  return inner;
}

const innerFunc = outer();
innerFunc(); // 10
```

1. `outer` í•¨ìˆ˜ í‰ê°€ í›„ í•¨ìˆ˜ ê°ì²´ ìƒì„±
2. ì¤‘ì²© í•¨ìˆ˜ `inner`ê°€ í‰ê°€ë¨
3. `outer` í•¨ìˆ˜ í˜¸ì¶œ

   â†’ `inner` í•¨ìˆ˜ë¥¼ ë°˜í™˜í•˜ê³  ìƒëª… ì£¼ê¸° ë§ˆê°, `outer` í•¨ìˆ˜ì˜ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ê°€ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ ìŠ¤íƒì—ì„œ pop

4. ê·¸ëŸ¬ë‚˜ outer í•¨ìˆ˜ì˜ ì§€ì—­ ë³€ìˆ˜ x ê°’ì¸ 10ì´ ì¶œë ¥ë¨

ğŸ’¡ **ì™¸ë¶€ í•¨ìˆ˜ë³´ë‹¤ ì¤‘ì²© í•¨ìˆ˜ê°€ ë” ì˜¤ë˜ ìœ ì§€**ë˜ëŠ” ê²½ìš°
â†’ ì¤‘ì²© í•¨ìˆ˜ëŠ” **ì´ë¯¸ ìƒëª… ì£¼ê¸°ê°€ ì¢…ë£Œí•œ ì™¸ë¶€ í•¨ìˆ˜ì˜ ë³€ìˆ˜ë¥¼ ì°¸ì¡°**í•  ìˆ˜ ìˆìŒ
ì´ëŸ¬í•œ ì¤‘ì²© í•¨ìˆ˜ = **í´ë¡œì €(closure)**

- í•¨ìˆ˜: ì–¸ì œë‚˜ ìì‹ ì´ ê¸°ì–µí•˜ëŠ” ìƒìœ„ ìŠ¤ì½”í”„ì˜ ì‹ë³„ìë¥¼ ì°¸ì¡° ê°€ëŠ¥
- `outer` í•¨ìˆ˜ì˜ ë ‰ì‹œì»¬ í™˜ê²½ì´ `inner` í•¨ìˆ˜ì˜ `[[Environment]]` ë‚´ë¶€ ìŠ¬ë¡¯ì— ì˜í•´ ì°¸ì¡°ë˜ê³  ìˆê³ , `inner` í•¨ìˆ˜ëŠ” `innerFunc`ì— ì˜í•´ ì°¸ì¡°ë˜ê³  ìˆìŒ â‡’ **ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ì˜ ëŒ€ìƒì´ ì•„ë‹˜!**
- ì™¸ë¶€ í•¨ìˆ˜ë³´ë‹¤ ë” ì˜¤ë˜ ìƒì¡´í•œ ì¤‘ì²© í•¨ìˆ˜: ì™¸ë¶€ í•¨ìˆ˜ì˜ ìƒì¡´ì—¬ë¶€ì™€ ìƒê´€ì—†ì´ ì‹ë³„ìë¥¼ ì°¸ì¡°í•˜ê±°ë‚˜ ê°’ ë³€ê²½ ê°€ëŠ¥

### í´ë¡œì €ì˜ ì¡°ê±´

1. **ì¤‘ì²© í•¨ìˆ˜ê°€ ìƒìœ„ ìŠ¤ì½”í”„ì˜ ì‹ë³„ìë¥¼ ì°¸ì¡°í•˜ê³ ,**
2. **ì¤‘ì²© í•¨ìˆ˜ê°€ ì™¸ë¶€ í•¨ìˆ˜ë³´ë‹¤ ë” ì˜¤ë˜ ìœ ì§€ë˜ëŠ” ê²½ìš°**

- ììœ  ë³€ìˆ˜(free valuable): í´ë¡œì €ì— ì˜í•´ ì°¸ì¡°ë˜ëŠ” ìƒìœ„ ìŠ¤ì½”í”„ì˜ ë³€ìˆ˜
- **ëª¨ë˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„**: ìµœì í™”ê°€ ì˜ ë˜ì–´ ìˆì–´ í´ë¡œì €ê°€ ì°¸ì¡°í•˜ê³  ìˆì§€ ì•Šì€ ì‹ë³„ìëŠ” ê¸°ì–µí•˜ì§€ ì•ŠìŒ(ë©”ëª¨ë¦¬ ë‚­ë¹„ ì—†ìŒ)

## 24.4 í´ë¡œì €ì˜ í™œìš©

ğŸ’¡ í´ë¡œì €: ìƒíƒœë¥¼ ì•ˆì „í•˜ê²Œ ë³€ê²½í•˜ê³  ìœ ì§€í•˜ê¸° ìœ„í•´ ì‚¬ìš© â†’ ìƒíƒœë¥¼ ì€ë‹‰, íŠ¹ì • í•¨ìˆ˜ì—ê²Œë§Œ ë³€ê²½ í—ˆìš©

**ğŸ“ŒÂ bad example**

```jsx
let num = 0;

const increase = function () {
  return ++num;
};
console.log(increase()); // 1
```

- ì¹´ìš´íŠ¸ ìƒíƒœ `num`ì— ëˆ„êµ¬ë‚˜ ì ‘ê·¼í•˜ê³  ë³€ê²½í•  ìˆ˜ ìˆìŒ (ì•”ë¬µì  ê²°í•©)

**ğŸ“ŒÂ good example**

```jsx
const increase = (function () {
  let num = 0;
  // í´ë¡œì €
  return function () {
    return ++num;
  };
})();

console.log(increase()); // 1
```

- ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜ í˜¸ì¶œ â†’ ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜ê°€ ë°˜í™˜í•œ í•¨ìˆ˜(í´ë¡œì €)ê°€ `increase` ë³€ìˆ˜ì— í• ë‹¹
- **í´ë¡œì €**: ìƒìœ„ ìŠ¤ì½”í”„ì¸ ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜ì˜ ë ‰ì‹œì»¬ í™˜ê²½ì„ ê¸°ì–µ
- **ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜**: í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ë¯€ë¡œ `num` ë³€ìˆ˜ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ
- `num` ë³€ìˆ˜: ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ì—†ëŠ” ì€ë‹‰ëœ private í•¨ìˆ˜

ğŸ’¡Â í´ë¡œì €ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ 

1. ìƒíƒœê°€ ì˜ë„ì¹˜ì•Šê²Œ ë³€ê²½ë˜ì§€ ì•Šë„ë¡ ì•ˆì „í•˜ê²Œ ì€ë‹‰í•˜ê³ ,
2. íŠ¹ì • í•¨ìˆ˜ì—ê²Œë§Œ ìƒíƒœ ë³€ê²½ìœ¼ë¡œ í—ˆìš©

**ğŸ“ŒÂ advanced example**

```jsx
const counter = (function () {
  let num = 0;
  // í´ë¡œì €ì¸ ë©”ì„œë“œë¥¼ ê°–ëŠ” ê°ì²´ ë°˜í™˜
  return {
    increase() {
      return ++num;
    },
    decrease() {
      return num > 0 ? --num : 0;
    },
  };
})();
console.log(counter.increase());
console.log(counter.decrease());
```

- ê°ì²´ ë¦¬í„°ëŸ´ì˜ ì¤‘ê´„í˜¸: **ì½”ë“œ ë¸”ë¡ì´ ì•„ë‹ˆë¯€ë¡œ ë³„ë„ì˜ ìŠ¤ì½”í”„ ìƒì„± X**
- `increase`, `decrease` ë©”ì„œë“œì˜ ìƒìœ„ ìŠ¤ì½”í”„: **ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜ì˜ ë ‰ì‹œì»¬ í™˜ê²½**

```jsx
// ìƒì„±ì í•¨ìˆ˜ë¡œ í‘œí˜„
const Counter = (function () {
  let num = 0;

  function Counter() {
    // í”„ë¡œí¼í‹°ëŠ” publicí•˜ë¯€ë¡œ ì€ë‹‰ X
    // this.num = 0;
  }
  Counter.prototype.increase = function () {
    return ++num;
  };
  Counter.prototype.decrease = function () {
    return num > 0 ? --num : 0;
  };
  return Counter;
})();

const counter = new Counter();
```

**ğŸ“ŒÂ í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë° ì˜ˆì‹œ**

```jsx
// í•¨ìˆ˜ë¥¼ ë°˜í™˜í•˜ëŠ” ê³ ì°¨ í•¨ìˆ˜
const counter = (function () {
  let counter = 0;

  // í•¨ìˆ˜ë¥¼ ì¸ìˆ˜ë¡œ ì „ë‹¬ë°›ëŠ” í´ë¡œì €ë¥¼ ë°˜í™˜
  return function (aux) {
    counter = aux(counter);
    return counter;
  };
})();

// ë³´ì¡° í•¨ìˆ˜
function increase(n) {
  return ++n;
}
function decrease(n) {
  return --n;
}

console.log(counter(increase));
console.log(counter(decrease));
```

## 24.5 ìº¡ìŠí™”ì™€ ì •ë³´ ì€ë‹‰

> **ìº¡ìŠí™”**: ê°ì²´ì˜ ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ëŠ” í”„ë¡œí¼í‹°ì™€ í”„ë¡œí¼í‹°ë¥¼ ì°¸ì¡°í•˜ê³  ì¡°ì‘í•  ìˆ˜ ìˆëŠ” ë©”ì„œë“œë¥¼ í•˜ë‚˜ë¡œ ë¬¶ëŠ” ê²ƒ

- ìº¡ìŠí™”ë¥¼ í†µí•´ ê°ì²´ì˜ íŠ¹ì • í”„ë¡œí¼í‹°ë‚˜ ë©”ì„œë“œë¥¼ ì€ë‹‰í•  ìˆ˜ ìˆìŒ
  â‡’ ê°ì²´ ê°„ì˜ ìƒí˜¸ ì˜ì¡´ì„±, ì¦‰ ê²°í•©ë„(coupling)ì„ ì§ì¶¤
- ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°ì²´ì˜ ëª¨ë“  í”„ë¡œí¼í‹°ì™€ ë©”ì„œë“œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ public

```jsx
const Person = (function () {
  let _age = 0; // private

  // ìƒì„±ì í•¨ìˆ˜
  function Person(name, age) {
    this.name = name; // public
    _age = age;
  }

  Person.prototype.sayHi = function () {
    console.log(`Hi, My name is ${this.name}. I am ${_age}.`);
  };
  return Person;
})();

const me = new Person("Lee", 20);
me.sayHi();
console.log(me.name); // Lee
console.log(me._age); // undefined
```

- `Person` ìƒì„±ì í•¨ìˆ˜, `sayHi` ë©”ì„œë“œ: ì¢…ë£Œë˜ì–´ ì†Œë©¸í•œ **ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜ì˜ ì§€ì—­ë³€ìˆ˜ `_age`ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆëŠ” í´ë¡œì €**

**ğŸš¨Â ì£¼ì˜í•  ì **

```jsx
const me = new Person("Lee", 20);
me.sayHi(); // Hi, My name is Lee. I am 20.

const you = new Person("Kim", 30);
you.sayHi(); // Hi, My name is Kim. I am 30.

// _age ê°’ì´ ë³€ê²½ë¨
me.sayHi(); // Hi, My name is Lee. I am 30.
```

- `Person.prototype.sayHi` ë©”ì„œë“œ: **ë‹¨ í•œë²ˆë§Œ ìƒì„±ë˜ëŠ” í´ë¡œì €**ì´ê¸° ë•Œë¬¸ì— ë°œìƒ
- ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ì •ë³´ ì€ë‹‰ì„ ì™„ì „í•˜ê²Œ ì§€ì›í•˜ì§€ ì•ŠìŒ
  - ìƒˆë¡œìš´ í‘œì¤€ ì‚¬ì–‘ìœ¼ë¡œ í´ë˜ìŠ¤ì— private í•„ë“œë¥¼ ì •ì˜í•  ìˆ˜ ìˆìŒ
